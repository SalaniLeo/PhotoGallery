<script lang="ts">
	import { rootData } from '$lib/stores';

	let emojiList = [
		{ emoji: 'ðŸ˜€', keyword: 'smile happy joy' },
		{ emoji: 'ðŸ˜ƒ', keyword: 'happy joy grin' },
		{ emoji: 'ðŸ˜„', keyword: 'grin smile joy' },
		{ emoji: 'ðŸ˜', keyword: 'smile teeth grin' },
		{ emoji: 'ðŸ˜†', keyword: 'laugh smile happy' },
		{ emoji: 'ðŸ˜…', keyword: 'sweat smile relieved' },
		{ emoji: 'ðŸ˜‚', keyword: 'tears joy laughing' },
		{ emoji: 'ðŸ¤£', keyword: 'rofl rolling laugh' },
		{ emoji: 'ðŸ¥²', keyword: 'smile tear bittersweet' },
		{ emoji: 'ðŸ¥¹', keyword: 'tears grateful touched' },
		{ emoji: 'ðŸ˜Š', keyword: 'smile blush happy' },
		{ emoji: 'ðŸ˜‡', keyword: 'angel innocent' },
		{ emoji: 'ðŸ™‚', keyword: 'smile content' },
		{ emoji: 'ðŸ™ƒ', keyword: 'upside down silly' },
		{ emoji: 'ðŸ˜‰', keyword: 'wink smile flirty' },
		{ emoji: 'ðŸ˜Œ', keyword: 'relieved calm' },
		{ emoji: 'ðŸ˜', keyword: 'heart eyes love' },
		{ emoji: 'ðŸ¥°', keyword: 'in love happy' },
		{ emoji: 'ðŸ˜˜', keyword: 'kiss flirty love' },
		{ emoji: 'ðŸ˜—', keyword: 'kiss happy' },
		{ emoji: 'ðŸ˜™', keyword: 'kiss smile happy' },
		{ emoji: 'ðŸ˜š', keyword: 'kiss closed eyes' },
		{ emoji: 'ðŸ˜‹', keyword: 'yum tasty' },
		{ emoji: 'ðŸ˜›', keyword: 'tongue playful' },
		{ emoji: 'ðŸ˜', keyword: 'tongue closed eyes' },
		{ emoji: 'ðŸ˜œ', keyword: 'wink tongue' },
		{ emoji: 'ðŸ¤ª', keyword: 'crazy silly' },
		{ emoji: 'ðŸ¤¨', keyword: 'raised eyebrow skeptical' },
		{ emoji: 'ðŸ§', keyword: 'monocle curious' },
		{ emoji: 'ðŸ¤“', keyword: 'nerd glasses geek' },
		{ emoji: 'ðŸ˜Ž', keyword: 'cool sunglasses' },
		{ emoji: 'ðŸ¥¸', keyword: 'disguise funny' },
		{ emoji: 'ðŸ¤©', keyword: 'star eyes excited' },
		{ emoji: 'ðŸ¥³', keyword: 'party celebration' },
		{ emoji: 'ðŸ˜', keyword: 'smirk smug' },
		{ emoji: 'ðŸ˜’', keyword: 'unimpressed discontent' },
		{ emoji: 'ðŸ˜ž', keyword: 'sad disappointed' },
		{ emoji: 'ðŸ˜”', keyword: 'sad pensive' },
		{ emoji: 'ðŸ˜Ÿ', keyword: 'worried concerned' },
		{ emoji: 'ðŸ˜•', keyword: 'confused unsure' },
		{ emoji: 'ðŸ™', keyword: 'frown sad' },
		{ emoji: 'â˜¹ï¸', keyword: 'frown upset' },
		{ emoji: 'ðŸ˜£', keyword: 'persevering stressed' },
		{ emoji: 'ðŸ˜–', keyword: 'confounded frustrated' },
		{ emoji: 'ðŸ˜«', keyword: 'tired exhausted' },
		{ emoji: 'ðŸ˜©', keyword: 'weary drained' },
		{ emoji: 'ðŸ¥º', keyword: 'pleading puppy eyes' },
		{ emoji: 'ðŸ˜¢', keyword: 'cry sad tears' },
		{ emoji: 'ðŸ˜­', keyword: 'sob tears crying' },
		{ emoji: 'ðŸ˜®â€ðŸ’¨', keyword: 'relief exhale' },
		{ emoji: 'ðŸ˜¤', keyword: 'triumph proud' },
		{ emoji: 'ðŸ˜ ', keyword: 'angry mad' },
		{ emoji: 'ðŸ˜¡', keyword: 'rage furious' },
		{ emoji: 'ðŸ¤¬', keyword: 'cursing angry swearing' },
		{ emoji: 'ðŸ¤¯', keyword: 'mind blown shocked' },
		{ emoji: 'ðŸ˜³', keyword: 'flushed surprised embarrassed' },
		{ emoji: 'ðŸ¥µ', keyword: 'hot sweating' },
		{ emoji: 'ðŸ¥¶', keyword: 'cold freezing' },
		{ emoji: 'ðŸ˜±', keyword: 'scream scared' },
		{ emoji: 'ðŸ˜¨', keyword: 'fearful scared' },
		{ emoji: 'ðŸ˜°', keyword: 'anxious worried sweat' },
		{ emoji: 'ðŸ˜¥', keyword: 'sad relieved disappointed' },
		{ emoji: 'ðŸ˜“', keyword: 'sweat disappointed' },
		{ emoji: 'ðŸ«£', keyword: 'peeking embarrassed' },
		{ emoji: 'ðŸ¤—', keyword: 'hugging warm' },
		{ emoji: 'ðŸ«¡', keyword: 'salute respect' },
		{ emoji: 'ðŸ¤”', keyword: 'thinking curious' },
		{ emoji: 'ðŸ«¢', keyword: 'oops shock' },
		{ emoji: 'ðŸ¤­', keyword: 'hand over mouth surprise' },
		{ emoji: 'ðŸ¤«', keyword: 'shush quiet' },
		{ emoji: 'ðŸ¤¥', keyword: 'lying nose' },
		{ emoji: 'ðŸ˜¶', keyword: 'speechless quiet' },
		{ emoji: 'ðŸ˜¶â€ðŸŒ«ï¸', keyword: 'foggy confused' },
		{ emoji: 'ðŸ˜', keyword: 'neutral indifferent' },
		{ emoji: 'ðŸ˜‘', keyword: 'expressionless blank' },
		{ emoji: 'ðŸ˜¬', keyword: 'grimace awkward' },
		{ emoji: 'ðŸ«¨', keyword: 'shaking shock' },
		{ emoji: 'ðŸ« ', keyword: 'melting embarrassed' },
		{ emoji: 'ðŸ™„', keyword: 'eyeroll annoyed' },
		{ emoji: 'ðŸ˜¯', keyword: 'surprised hushed' },
		{ emoji: 'ðŸ˜¦', keyword: 'frowning surprised' },
		{ emoji: 'ðŸ˜§', keyword: 'anguished shocked' },
		{ emoji: 'ðŸ˜®', keyword: 'open mouth surprised' },
		{ emoji: 'ðŸ˜²', keyword: 'astonished surprised' },
		{ emoji: 'ðŸ¥±', keyword: 'yawn tired' },
		{ emoji: 'ðŸ˜´', keyword: 'sleeping tired' },
		{ emoji: 'ðŸ¤¤', keyword: 'drooling sleepy' },
		{ emoji: 'ðŸ˜ª', keyword: 'sleepy tired' },
		{ emoji: 'ðŸ˜µ', keyword: 'dizzy confused' },
		{ emoji: 'ðŸ˜µâ€ðŸ’«', keyword: 'dizzy disoriented' },
		{ emoji: 'ðŸ«¥', keyword: 'disguised hidden' },
		{ emoji: 'ðŸ¤', keyword: 'zipper mouth quiet' },
		{ emoji: 'ðŸ¥´', keyword: 'woozy drunk' },
		{ emoji: 'ðŸ¤¢', keyword: 'nauseated sick' },
		{ emoji: 'ðŸ¤®', keyword: 'vomit sick' },
		{ emoji: 'ðŸ¤§', keyword: 'sneezing sick' },
		{ emoji: 'ðŸ˜·', keyword: 'mask sick' },
		{ emoji: 'ðŸ¤’', keyword: 'fever thermometer' },
		{ emoji: 'ðŸ¤•', keyword: 'hurt head bandage' },
		{ emoji: 'ðŸ¤‘', keyword: 'money greedy' },
		{ emoji: 'ðŸ¤ ', keyword: 'cowboy hat happy' },
		{ emoji: 'ðŸ˜ˆ', keyword: 'devil smiling evil' },
		{ emoji: 'ðŸ‘¿', keyword: 'angry devil' },
		{ emoji: 'ðŸ‘¹', keyword: 'ogre monster' },
		{ emoji: 'ðŸ‘º', keyword: 'goblin mask' },
		{ emoji: 'ðŸ¤¡', keyword: 'clown silly' },
		{ emoji: 'ðŸ’©', keyword: 'poop funny' },
		{ emoji: 'ðŸ‘»', keyword: 'ghost spooky' },
		{ emoji: 'ðŸ’€', keyword: 'skull dead' },
		{ emoji: 'â˜ ï¸', keyword: 'skull crossbones' },
		{ emoji: 'ðŸ‘½', keyword: 'alien extraterrestrial' },
		{ emoji: 'ðŸ‘¾', keyword: 'space invader alien' },
		{ emoji: 'ðŸŽƒ', keyword: 'pumpkin halloween' },
		{ emoji: 'ðŸ˜º', keyword: 'smile cat' },
		{ emoji: 'ðŸ˜¸', keyword: 'grinning cat' },
		{ emoji: 'ðŸ˜¹', keyword: 'tears joy cat' },
		{ emoji: 'ðŸ˜»', keyword: 'heart eyes cat' },
		{ emoji: 'ðŸ˜¼', keyword: 'smirk cat' },
		{ emoji: 'ðŸ˜½', keyword: 'kiss cat' },
		{ emoji: 'ðŸ™€', keyword: 'scared shocked cat' },
		{ emoji: 'ðŸ˜¿', keyword: 'crying sad cat' },
		{ emoji: 'ðŸ˜¾', keyword: 'angry cat' },
		{ emoji: 'ðŸ‘‹', keyword: 'wave hello' },
		{ emoji: 'ðŸ¤š', keyword: 'raised hand stop' },
		{ emoji: 'âœ‹', keyword: 'raised hand high five' },
		{ emoji: 'ðŸ––', keyword: 'vulcan salute star trek' },
		{ emoji: 'ðŸ‘Œ', keyword: 'ok hand gesture' },
		{ emoji: 'ðŸ¤Œ', keyword: 'pinched fingers italian gesture' },
		{ emoji: 'ðŸ¤', keyword: 'pinching small' },
		{ emoji: 'âœŒï¸', keyword: 'peace victory' },
		{ emoji: 'ðŸ¤ž', keyword: 'fingers crossed hope' },
		{ emoji: 'ðŸ«°', keyword: 'finger heart love' },
		{ emoji: 'ðŸ¤Ÿ', keyword: 'love you sign' },
		{ emoji: 'ðŸ¤˜', keyword: 'rock horns metal' },
		{ emoji: 'ðŸ¤™', keyword: 'call me hang loose' },
		{ emoji: 'ðŸ«µ', keyword: 'you pointing' },
		{ emoji: 'ðŸ«±', keyword: 'palm facing right' },
		{ emoji: 'ðŸ«²', keyword: 'palm facing left' },
		{ emoji: 'ðŸ«¸', keyword: 'pushing hand right' },
		{ emoji: 'ðŸ«·', keyword: 'pushing hand left' },
		{ emoji: 'ðŸ«³', keyword: 'hand holding down' },
		{ emoji: 'ðŸ«´', keyword: 'hand holding up' },
		{ emoji: 'ðŸ‘ˆ', keyword: 'point left' },
		{ emoji: 'ðŸ‘‰', keyword: 'point right' },
		{ emoji: 'ðŸ‘†', keyword: 'point up' },
		{ emoji: 'ðŸ–•', keyword: 'middle finger rude' },
		{ emoji: 'ðŸ‘‡', keyword: 'point down' },
		{ emoji: 'â˜ï¸', keyword: 'pointing up finger' },
		{ emoji: 'ðŸ‘', keyword: 'thumbs up approval' },
		{ emoji: 'ðŸ‘Ž', keyword: 'thumbs down disapproval' },
		{ emoji: 'âœŠ', keyword: 'raised fist power' },
		{ emoji: 'ðŸ‘Š', keyword: 'fist bump punch' },
		{ emoji: 'ðŸ¤›', keyword: 'left facing fist bump' },
		{ emoji: 'ðŸ¤œ', keyword: 'right facing fist bump' },
		{ emoji: 'ðŸ‘', keyword: 'clap applause' },
		{ emoji: 'ðŸ«¶', keyword: 'heart hands love' },
		{ emoji: 'ðŸ™Œ', keyword: 'raised hands celebration' },
		{ emoji: 'ðŸ‘', keyword: 'open hands give' },
		{ emoji: 'ðŸ¤²', keyword: 'palms together offering' },
		{ emoji: 'ðŸ¤', keyword: 'handshake agreement' },
		{ emoji: 'ðŸ™', keyword: 'praying hands thanks' }
	];

	export let showPicker = false;
	export let emoji = '';
	export let post_id = '';
	export let x: number;
	export let buttonWidth: number;

	let searchString: string = '';
	let filteredEmojis = [...emojiList];

	function searchEmoji() {
		searchString = searchString.toLowerCase();
		filteredEmojis = emojiList.filter(({ keyword }) =>
			keyword.toLowerCase().includes(searchString)
		);
	}

	async function addReaction(post_id: string) {
		const user_id = $rootData.user.info.user_id;
		try {
			const response = await fetch($rootData.addresses.react, {
				method: 'POST',
				body: JSON.stringify({ user_id, post_id, emoji }),
				headers: {
					'Content-Type': 'application/json'
				}
			});
			const result = await response.json();
		} catch (error) {
			console.error('Could not react to post');
		}
	}

	let innerWidth: number;
	let innerHeight: number;
	let dialog: HTMLDialogElement;

	let tmpWidth: number | undefined;
	let move: number = 0;
	let style: string;

	$: if (innerWidth) {
		if (tmpWidth === undefined) {
			tmpWidth = innerWidth;
		}
		if (innerWidth > 720 && innerWidth < 1000) {
			style = 'left: 75px';
		} else if (innerWidth < 720) {
			style = 'left: 30px';
		} else if (innerWidth > 1000) {
			move = (innerWidth - tmpWidth) / 2;
			style = `left: ${Math.round(x - 336 / 2) + buttonWidth / 2 + move}px;`;
		}
	}
</script>

<svelte:window bind:innerWidth bind:innerHeight />

<!-- svelte-ignore a11y-click-events-have-key-events -->
<!-- svelte-ignore a11y-no-static-element-interactions -->
<!-- svelte-ignore missing-declaration -->
<!-- svelte-ignore a11y-no-noninteractive-element-interactions -->
<div
	class="close_area"
	class:show={showPicker}
	on:click|stopPropagation={(e) => {
		// @ts-ignore
		if (!dialog.contains(e.target)) {
			showPicker = false;
		}
	}}
></div>

<dialog class="root outline" class:show={showPicker} bind:this={dialog} {style}>
	<input
		type="text"
		bind:value={searchString}
		on:input={() => {
			searchEmoji();
		}}
		placeholder="Search emojis..."
	/>
	<div class="selector">
		{#each filteredEmojis as row}
			<button
				class="transparent"
				on:click={() => {
					emoji = row.emoji;
					showPicker = !showPicker;
					addReaction(post_id);
				}}><p>{row.emoji}</p></button
			>
		{/each}
	</div>
</dialog>

<style>
	.close_area {
		width: 100vw;
		height: 100vh;
		background-color: transparent;
		display: none;
		position: fixed;
		left: 0px;
		top: 0px;
	}
	.root {
		transform: translateY(2rem);
		transition-duration: 0s !important;
		z-index: 10;
		position: absolute;
		display: none;
		width: 300px;
		height: 400px;
		gap: 1rem;
		background-color: var(--background-blurry);
		border-radius: var(--border-radius-heavy);
		margin: 0 !important;
		overflow-x: hidden;
		overflow-y: scroll;
		flex-direction: column;
		backdrop-filter: blur(10px);
		border: 2px solid var(--border-color);
	}
	.selector {
		overflow-x: hidden;
		display: flex;
		flex-wrap: wrap;
		align-items: center;
		font-size: 2rem;
		border-radius: var(--border-radius-heavy);
		gap: 0.5rem;
		text-align: center;
		justify-content: center;
	}
	.show {
		display: flex;
	}
	p {
		margin: 0 !important;
	}
	button {
		font-size: 2rem;
	}
</style>
